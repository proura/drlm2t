  
nets:
- name: net1
  ip: 192.168.181.1

hosts:
- name: srv1
  template: deb10
  nets:
  - name: net1
    ip: 192.168.181.2
  tests:
  # host: srv1 - test: 1
  # Update DRLM server making apt update & apt upgrade
  - name: update
    testtype: 1
    filetorun: update.test
  # host: srv1 - test: 2
  # install DRLM feature/incremental_backups of proura GitHub repository
  - name: installDRLM240
    testtype: 1
    filetorun: installCustomDRLM240.test
    args: [ 'https://github.com/proura/drlm', 'develop', 'drlm_2.4.0_all.deb' ]
  # host: srv1 - test: 3
  # Add backup networt to drlm networks in order to do PXE recovers
  - name: addNetwork
    testtype: 1
    commandtorun: "drlm -vD addnetwork -n BuLan -s 192.168.181.2  -m 255.255.255.0 -g 192.168.181.1"
  # host: srv1 - test: 4
  # Install Expect to automate responses of DRLM install client
  - name: installExpect
    testtype: 1
    commandtorun: "apt-get -y install expect"
  # host: srv1 - test: 5
  # Add client 1 - Debian 9 client
  - name: addCli1
    testtype: 1
    filetorun: installClient.test
    args: [ 'deb9cli', '192.168.181.53/24']
    dependencies:
    - host: cli1
      test: 1
  # host: srv1 - test: 6
  # Add client 2 - Debian 10 client
  - name: addCli2
    testtype: 1
    filetorun: installClient.test
    args: [ 'deb10cli', '192.168.181.54/24']
    dependencies:
    - host: cli2
      test: 1
  # host: srv1 - test: 7
  # Add client 3 - CentOS 7 client
  - name: addCli3
    testtype: 1
    filetorun: installClient.test
    args: [ 'cen7cli', '192.168.181.55/24']
    dependencies:
    - host: cli3
      test: 1
  # host: srv1 - test: 8
  # Add client 4 - CentOS 8 client
  - name: addCli4
    testtype: 1
    filetorun: installClient.test
    args: [ 'cen8cli', '192.168.181.56/24']
    dependencies:
    - host: cli4
      test: 1
  # host: srv1 - test: 9
  # Add client 5 - Ubuntu 18 client
  - name: addCli5
    testtype: 1
    filetorun: installClient.test
    args: [ 'ubu18cli', '192.168.181.57/24']
    dependencies:
    - host: cli5
      test: 1
  # host: srv1 - test: 10
  # Add client 6 - Ubuntu 20 client
  - name: addCli6
    testtype: 1
    filetorun: installClient.test
    args: [ 'ubu20cli', '192.168.181.58/24']
    dependencies:
    - host: cli6
      test: 1
  # host: srv1 - test: 11
  # get output of drlm listclient
  - name: listClients
    testtype: 1
    commandtorun: "drlm listclient"
#   ## test nÂº 10
#   - name: runBKPCli1
#     testtype: 1
#     commandtorun: "drlm runbackup -c deb9cli"  
#     dependencies:
#     - host: cli1
#       test: 2
#   - name: runBKPCli2
#     testtype: 1
#     commandtorun: "drlm runbackup -c deb10cli" 
#     dependencies:
#     - host: cli2
#       test: 2
#   - name: runBKPCli3
#     testtype: 1
#     commandtorun: "drlm runbackup -c cen7cli" 
#     dependencies:
#     - host: cli3
#       test: 2
#   - name: runBKPCli4
#     testtype: 1
#     commandtorun: "drlm runbackup -c cen8cli" 
#     dependencies:
#     - host: cli4
#       test: 2
#     landmark: true
#   - name: listBackups
#     testtype: 1
#     commandtorun: "drlm listbackup" 
#   - name: delDeb10clibkpbyID
#     testtype: 1
#     commandtorun: "drlm bkpmgr -d -I $(drlm listbackup -c deb10cli | grep deb10cli | awk '{ print $1 }'); drlm delbackup -c deb10cli -I $(drlm listbackup -c deb10cli | grep deb10cli | awk '{ print $1 }')"
#   - name: delCen7clibkpALL
#     testtype: 1
#     commandtorun: "drlm bkpmgr -d -I $(drlm listbackup -c cen7cli | grep cen7cli | awk '{ print $1 }'); drlm delbackup -c cen7cli -A"
#   - name: delCen8clibkpALL
#     testtype: 1
#     commandtorun: "drlm bkpmgr -d -I $(drlm listbackup -c cen8cli | grep cen8cli | awk '{ print $1 }'); drlm delbackup -c cen8cli -A"
#   - name: listBackups
#     testtype: 1
#     commandtorun: "drlm listbackup"
#   - name: addJobCli1
#     testtype: 1
#     commandtorun: "drlm addjob -c deb9cli -s $(date -d \"+1 minute\" +\"%Y-%m-%dT%H:%M\") -r 1day"
#     dependencies:
#     - host: cli1
#       test: 2
#   - name: waitBackupCli1
#     testtype: 1
#     commandtorun: "while [ \"$(drlm listbackup -c deb9cli | grep deb9cli | wc -l)\" -lt 2 ]; do echo \"wait...\"; sleep 10; done"
#   - name: listBackups
#     testtype: 1
#     commandtorun: "drlm listbackup"
#   - name: delAllDebb9clibkp
#     testtype: 1
#     commandtorun: "drlm delbackup -c deb9cli -A"  
#   - name: delAllDebb9clibkp2
#     testtype: 1
#     commandtorun: "drlm bkpmgr -d -I $(drlm listbackup -c deb9cli | grep deb9cli | awk '{ print $1 }'); drlm delbackup -c deb9cli -A"  

- name: cli1
  template: deb9
  nets:
  - name: net1
    ip: 192.168.181.53
  tests:
  # host: deb9 - test: 1
  - name: update
    filetorun: update.test
    expect: "OK"
  # host: deb9 - test: 2
  - name: prepareRescue
    filetorun: prepRescueCLI.test
    testtpe: 1
    dependencies:
    - host: srv1
      test: 5 

- name: cli2
  template: deb10
  nets:
  - name: net1
    ip: 192.168.181.54
  tests:
  # host: deb10 - test: 1
  - name: update
    filetorun: update.test
    expect: "OK"
  # host: deb10 - test: 2
  - name: prepareRescue
    filetorun: prepRescueCLI.test
    testtpe: 1
    dependencies:
    - host: srv1
      test: 6

- name: cli3
  template: cen7
  nets:
  - name: net1
    ip: 192.168.181.55
  tests:
  # host: cen7 - test: 1
  - name: update
    filetorun: update.test
    expect: "OK" 
  # host: cen7 - test: 2 
  - name: prepareRescue
    filetorun: prepRescueCLI.test
    testtpe: 1
    dependencies:
    - host: srv1
      test: 7

- name: cli4
  template: cen8
  nets:
  - name: net1
    ip: 192.168.181.56
  tests:
  # host: cen8 - test: 1 
  - name: update
    filetorun: update.test
    expect: "OK" 
  # host: cen8 - test: 2 
  - name: prepareRescue
    filetorun: prepRescueCLI.test
    testtpe: 1
    dependencies:
    - host: srv1
      test: 8

- name: cli5
  template: ubu18
  nets:
  - name: net1
    ip: 192.168.181.57
  tests:
  # host: ubu18 - test: 1 
  - name: update
    filetorun: update.test
    expect: "OK" 
  # host: ubu18 - test: 2
  - name: prepareRescue
    filetorun: prepRescueCLI.test
    testtpe: 1
    dependencies:
    - host: srv1
      test: 9

- name: cli6
  template: ubu20
  nets:
  - name: net1
    ip: 192.168.181.58
  tests:
  # host: ubu20 - test: 1
  - name: update
    filetorun: update.test
    expect: "OK" 
  # host: ubu20 - test: 2
  - name: prepareRescue
    filetorun: prepRescueCLI.test
    testtpe: 1
    dependencies:
    - host: srv1
      test: 10
